# This script is called during setup.
# You can use 'setup_module' to access the contents of the iob_soc_setup.py python module

#Check if setup with USE_EXTMEM (check if macro exists)
ext_mem = next((i for i in setup_module.confs if i['name']=='USE_EXTMEM'), False)
#Check if setup with INIT_MEM (check if macro exists)
init_mem = next((i for i in setup_module.confs if i['name']=='INIT_MEM'), False)

with open(setup_module.build_dir+"/hardware/fpga/fpga_build.mk",'r') as file: contents = file.readlines()
contents.insert(0,"\n#Line below was auto generated by fpga_setup.py\n")
#Set USE_EXTMEM=1 in fpga_build.mk if system was setup with EXTMEM
if ext_mem and ext_mem['val']: contents.insert(1,"USE_EXTMEM:=1\n\n")
else: contents.insert(1,"USE_EXTMEM:=0\n\n")
#Set INIT_MEM=1 in fpga_build.mk if system was setup with INIT_MEM
if init_mem and init_mem['val']: contents.insert(1,"INIT_MEM:=1\n\n")
else: contents.insert(1,"INIT_MEM:=0\n\n")
with open(setup_module.build_dir+"/hardware/fpga/fpga_build.mk",'w') as file: file.writelines(contents)

